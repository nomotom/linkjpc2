# Modules

主要モジュール、フィルタの設定に関する変更のまとめ

## 主要モジュール

### **モジュール共通**

#### 概要
- モジュール共通の設定

#### 主な変更点
- ディレクトリ構成(ID変更対応)
- ENEカテゴリ、表記の情報ファイル指定

|arguments | 説明 | 変更点                       |
|----|----|---------------------------|
|common_data_dir|共通データ用ディレクトリ|                           |
|tmp_data_dir|入力ファイル別データ用ディレクトリ| （ID変更対応でサブディレクトリの構成に変更あり） |
|sample_gold_dir|サンプルデータの正解用ディレクトリ | （ID変更対応でサブディレクトリの構成に変更あり）        |
|sample_input_dir|サンプルデータの入力ファイル用ディレクトリ| （ID変更対応でサブディレクトリの構成に変更あり）        | 
|out_dir|実行結果ファイル等のディレクトリ|                           | 

| option            | 説明   | 変更点   |
|-------------------|------|-------|
| mod               | 利用モジュール（優先度によりグルーピング） |       |
| mod_w             | モジュールの優先度グループ別の重み ||
| filtering         | 利用フィルタリング ||
| ans_max           | 出力数  ||
| score_type        | スコアタイプ ||
| f_titl2pid_ext    | title2pageid を元に拡張した情報ファイル ||
| f_target_attr_info | メンションの属性のファイル名 ||
|f_all_cat_info| ENEカテゴリのID, 表記情報のファイル名| 新規追加  |


### **matching.py(ma):文字列マッチ**

#### 概要
- メンションと候補ページのタイトルの文字列マッチ

#### 主な変更点
- 外国語タイトルも利用（言語間リンク利用）

| option                         | 説明                                               | 変更点                 |
|--------------------------------|--------------------------------------------------|---------------------|
| char_match_cand_num_max/-c_max | リンク先候補数の最大値                                      |                     |
| multi_lang                     | 外国語のタイトルも利用（言語間リンク使用) | 新規追加<br>デフォルト：全言語利用 |
| mint                           | (mint)タイトルにメンション文字列を含むページへのマッチング(mention in title)方法(完全一致/部分一致) |    |
| mint_min                       | (mint)文字列一致率の最小値  | デフォルト値変更            |
| title_matching_mint/tmm        | (mint)タイトルの丸括弧の扱い(full/trim(括弧を外す))  ||
| f_mint                         | (mint)文字列一致情報ファイル(full)                          ||
| f_mint_trim                    | (mint)文字列一致情報ファイル(trim)')                        ||
| tinm                           | (tinm)メンション文字列に含まれるタイトルをもつページへのマッチング(title in mention)方法(完全一致/部分一致) ||
| tinm_min/t_min                 | (tinm)文字列一致の最小値                                  ||
| title_matching_tinm/tmt        | (tinm)タイトルの丸括弧の扱い(full/trim(括弧を外す))              ||
| f_tinm                         | (tinm)文字列一致情報ファイル(full)                          |                     |
| f_tinm_trim                    | (tinm)文字列一致情報ファイル(trim)                          |                     |

### **self_link.py(sl):再帰リンク推定** 

#### 概要
- メンションから元記事へのリンクをサンプルデータ正解の統計情報から推定。典型的には別名などの特別な属性の場合。

#### 主な変更点
- スコアの計算方法
  - 統計情報の不足（サンプルデータに出現しない属性等）を補うためスコアリング方法(slink_prob)にルールベースのスコアリング(*_est)を追加

| option                   | 説明                                | 変更点                |
|--------------------------|-----------------------------------|--------------------|
| slink_min      | 再帰リンクの判定基準とする再帰リンク率の最小値           |                    |
| slink_prob               | 再帰リンクのスコアリング | optionの値を追加(*_est） |
| f_slink                  | 再帰リンク率情報ファイル                      |                    |
| f_self_link_by_attr_name | 再帰リンク用属性名リスト（属性名から推定する場合に利用）      | 新規追加               |

### **get_wlink.py(gw)** 

#### 概要
- メンションのリンク先を元記事のWikipedia内部リンクから探す
#### 主な変更点
 

| option                         | 説明                                                                                                                                                                               | 主な変更点 |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------|
| wlink /wl                      | Wikipediaリンクのスコアリング方法(どの環境に現れたタグに加点するか) <br>f: メンション内の最初のリンクを優先<br> r: メンション内の最右のリンクを優先<br>m: メンション内の全てのリンクに同等に加点<br>p: ページ内で既出の(メンションの)リンクに加点<br>l: メンション周辺の行のリンクに加点<br>n: N/A. |       |
| f_html_info                    | htmlタグ情報ファイル                                                                                                                                                                     |       | 
| wf_score   /wf                 | メンション内の最初のWikipediaリンクに与えるスコア  (cf. wlink:f)                                                                                                                                     |       |
| wr_score /wr                   | メンション内の最右のWikipediaリンクに与えるスコア (cf. wlink:r)                                                                                                                                      |       |  
| wp_score  /wp                  | ページ内で前出の(メンションの)Wikipediaリンクに与えるスコア (cf. wlink:p)                                                                                                                                |       |
| wl_score_same  /wls            | メンション周辺（同一行）にあるWikipediaリンクに与えるスコア (wlink:l)                                                                                                                                     |       |                  |
| wl_score_backward  /wlb        | メンション周辺（後の行）にあるWikipediaリンクに与えるスコア(wlink:l)                                                                                                                                      |       |  
| wl_score_forward /wlf          | メンション周辺（前の行）にあるWikipediaリンクに与えるスコア  (wlink:l)                                                                                                                                    |       |
| wl_break                       | 候補のリンクが見つかったら探索をやめるかどうかのフラグ                                                                                                                                                      |       | 
| wl_lines_backward_ca /wl_bca   | 各カテゴリ-属性のペアについてメンションから遡ってWikipediaリンクを探す際の行数の最大値の決定方法                                                                                                                            |       | 
| wl_lines_forward_ca /wl_fca    | 各カテゴbcaリ-属性のペアについてメンション以降でWikipediaリンクを探す際の行数の最大値の決定方法                                                                                                                           |       |
| wl_lines_backward_max /wl_bmax | メンションを含む行から遡ってWikipediaリンクを探す行数の最大値 (cf.wl_lines_backward_ca)                                                                                                                    |       |
| wl_lines_forward_max /wl_fmax  | メンションを含む行以降でWikipediaリンクを探す行数の最大値 (cf.wl_lines_forward_ca)                                                                                                                       |       |
| f_wl_lines_backward_ca         | 各カテゴリ-属性のペアについてメンションから遡ってWikipediaリンクを探す際の行数の最大値の指定ファイル(cf. wl_lines_backward_ca)                                                                                                |       |    
| wl_lines_forward_ca            | 各カテゴリ-属性のペアについてメンション以降でWikipediaリンクを探す際の行数の最大値の指定ファイル (cf. wl_lines_lines_forward_ca)                                                                                            |       |
| wl_lines_backward_ca_ratio     | 各属性についてメンションから遡ってWikipediaリンクを探す際の行のratioの最大値（候補行数は各属性についてサンプルデータの統計から推定）                                                                                                        |       |
| wl_lines_forward_ca_ratio      | 各属性についてメンション以降でWikipediaリンクを探す際の行のratioの最大値（候補行数は各属性についてサンプルデータの統計から推定）                                                                                                          |       |
| f_mention_gold_link_dist_info  | サンプルデータのメンションと正解Wikipediaリンクの距離に関する統計情報の出力ファイル名                                                                                                                                  |       |


### **link_prob.py(lp):リンク確率** 
#### 概略
   - メンションとページのリンク確率をサンプルデータ正解の統計情報から推定。
#### 主な変更点
| option | 説明   |変更点|
|------|------|----|
|lp_min|カテゴリ-属性-メンションの組に対してリンク確率情報ファイルに記載するリンク確率の最小値||
|f_link_prob|リンク確率情報ファイルのファイル名||

## フィルタリング 

### **attr_range_filtering.py(ar)** 
#### 概要
- メンション(属性値)のクラスによるフィルタリング
#### 主な変更点
- 統計情報の不足（サンプルデータに出現しない属性等）を補うためルールベースのスコアリングを追加

| option                 | 説明                                                              | 変更点  |
|------------------------|-----------------------------------------------------------------|------|
| attr_rng_auto_freq_min | トレーニングデータからrangeの情報を取得するメンションの頻度の最小値)                           | 新規追加 | 
| attr_rng_tgt           | メンション(属性値)のrange(とりうる値のタイプ、現状はENEカテゴリでクラスを指定)によるフィルタリングの対象モジュール ||
| f_attr_rng_auto        | メンション(属性値)のrangeによるフィルタリングの定義情報ファイル(サンプルデータの統計を元に自動で作成)         | 新規追加 |
| f_attr_rng_man         | メンション(属性値)のrangeによるフィルタリングの定義情報ファイル(人手での定義がベース)                 | 新規修正 |
| f_attr_rng_merged      | メンション(属性値)のrangeによるフィルタリングの定義情報ファイル(マージ)                        | 新規追加 |
| f_enew_info            | ENEW情報ファイルのファイル名                                                |      |
| attr_na_co             | ENEWがない候補ページの基本スコア(attr_na_co)                                  |      |                           
| attr_ng_co             | メンション(属性値)のrangeが一致しない候補ページの基本スコア                               |      |
| attr_len               | メンション(属性値)のrangeが一致する候補ページのENEIDのスコアリング                         |      |
| attr_rng_type          | メンション(属性値)のrangeによるフィルタリング方法                                    | 新規追加 |

### **incl_filtering.py(il)** 

#### 概要
 - 被リンク数によるフィルタリング
#### 主な変更点
| option           | 説明                             | 変更点  |
|------------------|--------------------------------|------|
| incl_max/i_max   | 被リンク数によるフィルタリングで候補とする被リンク数の最大値 ||
| incl_tgt/i_tgt   | 被リンク数によるフィルタリングの対象モジュール    |      |
| incl_type/i_type | 被リンク数によるフィルタリング方法        |      |

### **back_link.py(bl)** 

概要
- バックリンクによるフィルタリング

| option                     | 説明                       |変更点 |
|----------------------------|--------------------------|----|
|back_link_tgt/bl_tgt| バックリンクによるフィルタリングの対象モジュール ||
|back_link_ng/bl_ng| バックリンクなしのスコア             ||
|back_link_ok/bl_ok| バックリンクありのスコア             ||

###  **detect_nil.py(dn):nil判定** 
#### 概要
- nil detection(リンクなしの判定) によるフィルタリング
- サンプルデータの統計情報（カテゴリ・属性単位）からリンク先なしとするか判定。
- 各モジュールの処理前に判定し、該当する場合はモジュールの処理から外す。
#### 主な変更点
- 統計情報の不足（サンプルデータに出現しない属性等）による誤推定を防ぐためルールベースの判定条件を追加

| option            | 説明                                                         | 変更点                            |
|-------------------|------------------------------------------------------------|--------------------------------|
| nil_all_freq_min  | リンク確率情報ファイルの記述対象とするカテゴリ-属性-メンションのサンプルデータ中の頻度の最小値           | 新規追加                           |
| nil_tgt           | nil detectionの対象モジュール                                      ||
| nil_cond          | nil判定の条件                                                   | optionの値を追加(人手によるルールベースの条件を追加) |
| nil_desc_exception | nil判定のdescriptiveness条件の適用外の例外カテゴリ-属性リスト                   | optionの値を拡張                    |
| nil_cat_attr_max  | サンプルデータのカテゴリ-属性対のうち リンク先なしとするratioの最大値                     |                                |
| len_desc_text_min | nil判定でメンションテキストがdescriptiveと判定するメンションの最小値                  ||
|f_linkable_info| サンプルデータ中のカテゴリ-属性の出現回数とリンク率の情報ファイルのファイル名                    |                                |
| f_nil_cand_man    | nil判定対象候補のカテゴリ・属性候補(人手で記述)   (cf. nil_cond(cman))          | 新規追加                           |
| f_nil_stop_attr   | nil判定対象外の属性候補(人手で記述)  <BR>           cf.nil_cond(.nostop.) | 新規追加                           |

## 前処理

| STEP | 処理                                            | 概要                                                                                                 | 変更点                |
|------|-----------------------------------------------|----------------------------------------------------------------------------------------------------|--------------------|
| A-1  | gen_change_wikipedia_info                     | Wikipediaページの変更情報作成                                                                                | 新規追加               |
| A-2  | conv_sample_json_pageid                       | サンプルデータの旧ページIDを新IDに更新                                                                              | 新規追加               |
| A-3  | gen_target_attr                               | ENEのカテゴリと属性の情報作成                                                                                   | 新規追加               |
| A-4  | gen_enew/gen_enew_rev_year                    | ENEW情報の作成（＋ページID更新）                                                                                | 変更（ID変更対応等）        |
| A-5  | gen_title2pid                                 | Wikipediaページの転送関連情報作成                                                                              | 新規追加               |
| A-6  | gen_incoming_link                             | Wikipediaページの被リンク情報作成                                                                              |                    |
| A-7  | gen_redirect                                  | Wikipediaページの曖昧さ回避情報作成、曖昧さ回避ページを除去した転送情報作成                                                         |                    |
| A-8  | gen_title2pid_ext                             | リダイレクトページ詳細情報（incoming link数、ENEIDを追加）作成                                                           | 変更（フォーマット）         |
| A-9  | gen_lang_link_info                            | 言語間リンク情報の作成                                                                                        | 新規追加               |
| A-10 | pre_matching                                  | メンションとページタイトル文字列の一致率情報の作成                                                                          | 変更（外国語タイトル対応）      |
| A-11 | gen_back_link                                 | 入力ファイルのタイトル情報、back link情報作成                                                                        |                    |
| A-12 | gen_sample_gold_tsv                           | サンプルデータ正解情報作成                                                                                      | 変更（フォーマット）         |
| A-13 | gen_link_prob                                 | カテゴリ・属性の種類・属性値の組合せに対するリンク先確率情報（サンプルデータの統計情報ベース）                                                    |
| A-14 | gen_slink                                     | 再帰リンク情報の作成（１)サンプルデータの統計情報ベース、2)人手で指定した属性名ベース                                                       | 変更（ルールベース追加等）      |
| A-15 | gen_nil                                       | リンク確率情報の作成（サンプルデータの統計情報ベース）                                                                        | 変更（リンク先なしの判定方法追加等） |
| A-16 | gen_attr_rng                                  | カテゴリ・属性のペアに対する属性値（メンション）のrange(とりうる値のタイプ、現状はENEカテゴリでクラスを指定)の生成(1)サンプルデータの統計情報ベース、2)人手で記述したルールをベース) | 変更 （ルールベース追加等）     |
| B-1  | gen_common_html/<br>gen_common_html_conv_year | サンプルデータ(html)のWikipedia内部リンク情報作成（＋ページID更新）                                                         | 変更（ID変更対応等）        |
| B-2  | gen_link_dist                                 | サンプルデータ(html)のメンションと正解のWikipedia内部リンクの距離情報作成                                                       |                    |
| B-3  | gen_html/<br>gen_html_conv_year               | 入力ファイル(html)のWikipedia内部リンク情報作成                                                                    | 変更（ID変更対応等）        |

